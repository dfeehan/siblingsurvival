<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Estimating maternal mortality rates from sibling history data • siblingsurvival</title>
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet">
<link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet">
<script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Estimating maternal mortality rates from sibling history data">
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">siblingsurvival</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.3.0</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="active nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles">
<li><a class="dropdown-item" href="../articles/maternal-estimates.html">Estimating maternal mortality rates from sibling history data</a></li>
    <li><a class="dropdown-item" href="../articles/preparing-data.html">Preparing DHS data</a></li>
    <li><a class="dropdown-item" href="../articles/sibling-estimates.html">Estimating death rates from sibling history data</a></li>
  </ul>
</li>
<li class="nav-item"><a class="nav-link" href="../news/index.html">Changelog</a></li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json">
</form></li>
      </ul>
</div>


  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">

      <h1>Estimating maternal mortality rates from sibling history data</h1>
                        <h4 data-toc-skip class="author">Dennis M.
Feehan</h4>
            
            <h4 data-toc-skip class="date">2026-02-25</h4>
      

      <div class="d-none name"><code>maternal-estimates.Rmd</code></div>
    </div>

    
    
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="http://dennisfeehan.org/siblingsurvival/">siblingsurvival</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://tidyverse.tidyverse.org" class="external-link">tidyverse</a></span><span class="op">)</span></span>
<span><span class="co">#&gt; Warning: package 'tibble' was built under R version 4.4.3</span></span>
<span><span class="co">#&gt; Warning: package 'purrr' was built under R version 4.4.3</span></span>
<span><span class="co">#&gt; Warning: package 'dplyr' was built under R version 4.4.3</span></span>
<span><span class="co">#&gt; ── <span style="font-weight: bold;">Attaching core tidyverse packages</span> ──────────────────────── tidyverse 2.0.0 ──</span></span>
<span><span class="co">#&gt; <span style="color: #00BB00;">✔</span> <span style="color: #0000BB;">dplyr    </span> 1.2.0     <span style="color: #00BB00;">✔</span> <span style="color: #0000BB;">readr    </span> 2.1.5</span></span>
<span><span class="co">#&gt; <span style="color: #00BB00;">✔</span> <span style="color: #0000BB;">forcats  </span> 1.0.1     <span style="color: #00BB00;">✔</span> <span style="color: #0000BB;">stringr  </span> 1.6.0</span></span>
<span><span class="co">#&gt; <span style="color: #00BB00;">✔</span> <span style="color: #0000BB;">ggplot2  </span> 4.0.0     <span style="color: #00BB00;">✔</span> <span style="color: #0000BB;">tibble   </span> 3.3.1</span></span>
<span><span class="co">#&gt; <span style="color: #00BB00;">✔</span> <span style="color: #0000BB;">lubridate</span> 1.9.4     <span style="color: #00BB00;">✔</span> <span style="color: #0000BB;">tidyr    </span> 1.3.1</span></span>
<span><span class="co">#&gt; <span style="color: #00BB00;">✔</span> <span style="color: #0000BB;">purrr    </span> 1.2.1     </span></span>
<span><span class="co">#&gt; ── <span style="font-weight: bold;">Conflicts</span> ────────────────────────────────────────── tidyverse_conflicts() ──</span></span>
<span><span class="co">#&gt; <span style="color: #BB0000;">✖</span> <span style="color: #0000BB;">dplyr</span>::<span style="color: #00BB00;">filter()</span> masks <span style="color: #0000BB;">stats</span>::filter()</span></span>
<span><span class="co">#&gt; <span style="color: #BB0000;">✖</span> <span style="color: #0000BB;">dplyr</span>::<span style="color: #00BB00;">lag()</span>    masks <span style="color: #0000BB;">stats</span>::lag()</span></span>
<span><span class="co">#&gt; <span style="color: #00BBBB;">ℹ</span> Use the conflicted package (<span style="color: #0000BB; font-style: italic;">&lt;http://conflicted.r-lib.org/&gt;</span>) to force all conflicts to become errors</span></span>
<span><span class="co"># be sure you have at least version 0.0.2.9000 of surveybootstrap</span></span>
<span><span class="co"># run devtools::install_github('dfeehan/surveybootstrap')</span></span>
<span><span class="co"># for the most recent version</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://dfeehan.github.io/surveybootstrap/" class="external-link">surveybootstrap</a></span><span class="op">)</span>  </span>
<span></span>
<span><span class="co"># this is helfpul for timing</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/jabiru/tictoc" class="external-link">tictoc</a></span><span class="op">)</span></span></code></pre></div>
<div class="section level2">
<h2 id="overview">Overview<a class="anchor" aria-label="anchor" href="#overview"></a>
</h2>
<p>This vignette shows how to use the <code>siblingsurvival</code>
package to estimate quantities related to maternal mortality. You might
find it helpful to also read the <a href="sibling-estimates.html">vignette about estimating mortality
rates</a>; much of the material here is based on that vignette. In fact,
the process for estimating maternal mortality rates is very similar to
estimating all-cause death rates, with a few modifications which we will
explain in this vignette.</p>
<p>It will be helpful to define a few important terms before we start
our analysis:</p>
<ul>
<li>
<code>ego</code> - an ego is a survey respondent</li>
<li>
<code>cell</code> - a cell is a generic group for which we wish to
produce estimates. Usually, a cell is defined by a time period, an age
range, and a sex. So, for example, a cell might be women who were age
30-34 in 2015.</li>
</ul>
<p>As an overview, we’ll start from a survey dataset, such as the one
provided by the DHS. We then use <code>prep_dhs_sib_histories</code> to
produce two datasets:</p>
<ul>
<li>one dataset has a row for each survey respondent/ego</li>
<li>one dataset has a row for each sibling who is reported by a survey
respondent</li>
</ul>
<p>We’ll then calculate estimates from the sibling histories in three
main steps:</p>
<ol style="list-style-type: decimal">
<li>Create an <strong>esc</strong> dataset, so called because there is
row for each <strong>e</strong>go X <strong>s</strong>ibling X
<strong>c</strong>ell</li>
<li>Aggregate this esc dataset up into an <strong>ec</strong> dataset,
which has a row for the reports made by each ego for each cell</li>
<li>Aggregate this ec dataset up into estimates for death rates, using
either the individual or aggregate visibility approach (or both)</li>
</ol>
<div class="section level3">
<h3 id="opening-up-the-demo-datasets">Opening up the demo datasets<a class="anchor" aria-label="anchor" href="#opening-up-the-demo-datasets"></a>
</h3>
<p>We’ll start by opening up the demonstration DHS dataset.</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/utils/data.html" class="external-link">data</a></span><span class="op">(</span><span class="va">model_dhs_dat</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="using-prep_dhs_sib_histories-to-get-ego-and-sib-datasets">Using <code>prep_dhs_sib_histories</code> to get ego and sib
datasets<a class="anchor" aria-label="anchor" href="#using-prep_dhs_sib_histories-to-get-ego-and-sib-datasets"></a>
</h3>
<p>Now we’ll use <code>prep_dhs_sib_histories</code> to ready the
sibling histories for analysis. (Please see the <a href="preparing-data.html">Preparing Data</a> vignette for more
details.) This is the step that will produce two datasets: one with a
row for each survey respondent/ego; and one with a row for each reported
sibling. Note that we include the parameter
<code>add_maternal=TRUE</code> to indicate that we want columns related
to maternal/pregnancy-related mortality to be added.</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">prepped</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/prep_dhs_sib_histories.html">prep_dhs_sib_histories</a></span><span class="op">(</span><span class="va">model_dhs_dat</span>,</span>
<span>                                  varmap <span class="op">=</span> <span class="va">sibhist_varmap_dhs6</span>,</span>
<span>                                  add_maternal <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>                                  keep_missing <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; No information on respondent sex given; assuming all respondents are female.</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Found wwgt column; assuming we have a DHS survey and scaling weights.</span></span>
<span><span class="co">#&gt; Adding pregnancy-related/maternal death info</span></span>
<span><span class="co">#&gt; ...sib.died.accident column not found; only pregnancy-related deaths can be identified here</span></span>
<span><span class="co">#&gt; 638 out of 35082 (1.82%) reports about sibs have unknown survival status.</span></span>
<span><span class="co">#&gt; 602 out of 35082 (1.72%) reports about sibs have unknown sex.</span></span>
<span><span class="co">#&gt; Removing reported sibs missing survival status or sex.</span></span>
<span><span class="co">#&gt; ... this removes  642  out of  35082  ( 1.83 %)  sibling reports.</span></span>
<span></span>
<span><span class="co"># we'll only keep the variable we will need for this analysis</span></span>
<span><span class="va">ex.ego</span> <span class="op">&lt;-</span> <span class="va">prepped</span><span class="op">$</span><span class="va">ego.dat</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="co">## add a 'sex' variable</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>sex <span class="op">=</span> <span class="st">'f'</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="va">caseid</span>, </span>
<span>         <span class="va">psu</span>, </span>
<span>         <span class="va">stratum_analysis</span>, </span>
<span>         <span class="va">stratum_design</span>, </span>
<span>         <span class="va">cluster</span>, </span>
<span>         <span class="va">age.cat</span>, <span class="va">sex</span>, <span class="va">wwgt</span><span class="op">)</span></span>
<span><span class="va">ex.sib</span> <span class="op">&lt;-</span> <span class="va">prepped</span><span class="op">$</span><span class="va">sib.dat</span></span></code></pre></div>
<p>Let’s take a look at the datasets we’ve produced. First, here’s a
dataset that has information about survey respondents. (We’ll refer to
these survey respondents as ‘ego’):</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://pillar.r-lib.org/reference/glimpse.html" class="external-link">glimpse</a></span><span class="op">(</span><span class="va">ex.ego</span><span class="op">)</span></span>
<span><span class="co">#&gt; Rows: 8,348</span></span>
<span><span class="co">#&gt; Columns: 8</span></span>
<span><span class="co">#&gt; $ caseid           <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span> "        1  1  2"<span style="color: #949494;">, </span>"        1  3  2"<span style="color: #949494;">, </span>"        1  4  …</span></span>
<span><span class="co">#&gt; $ psu              <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> 1<span style="color: #949494;">, </span>1<span style="color: #949494;">, </span>1<span style="color: #949494;">, </span>1<span style="color: #949494;">, </span>1<span style="color: #949494;">, </span>1<span style="color: #949494;">, </span>1<span style="color: #949494;">, </span>1<span style="color: #949494;">, </span>1<span style="color: #949494;">, </span>1<span style="color: #949494;">, </span>1<span style="color: #949494;">, </span>1<span style="color: #949494;">, </span>1<span style="color: #949494;">, </span>1<span style="color: #949494;">, </span>1<span style="color: #949494;">, </span>1<span style="color: #949494;">, </span>1<span style="color: #949494;">, </span>1<span style="color: #949494;">,</span>…</span></span>
<span><span class="co">#&gt; $ stratum_analysis <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> 26<span style="color: #949494;">, </span>26<span style="color: #949494;">, </span>26<span style="color: #949494;">, </span>26<span style="color: #949494;">, </span>26<span style="color: #949494;">, </span>26<span style="color: #949494;">, </span>26<span style="color: #949494;">, </span>26<span style="color: #949494;">, </span>26<span style="color: #949494;">, </span>26<span style="color: #949494;">, </span>26<span style="color: #949494;">, </span>26<span style="color: #949494;">, </span>26<span style="color: #949494;">, </span>2…</span></span>
<span><span class="co">#&gt; $ stratum_design   <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> 4<span style="color: #949494;">, </span>4<span style="color: #949494;">, </span>4<span style="color: #949494;">, </span>4<span style="color: #949494;">, </span>4<span style="color: #949494;">, </span>4<span style="color: #949494;">, </span>4<span style="color: #949494;">, </span>4<span style="color: #949494;">, </span>4<span style="color: #949494;">, </span>4<span style="color: #949494;">, </span>4<span style="color: #949494;">, </span>4<span style="color: #949494;">, </span>4<span style="color: #949494;">, </span>4<span style="color: #949494;">, </span>4<span style="color: #949494;">, </span>4<span style="color: #949494;">, </span>4<span style="color: #949494;">, </span>4<span style="color: #949494;">,</span>…</span></span>
<span><span class="co">#&gt; $ cluster          <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> 1<span style="color: #949494;">, </span>1<span style="color: #949494;">, </span>1<span style="color: #949494;">, </span>1<span style="color: #949494;">, </span>1<span style="color: #949494;">, </span>1<span style="color: #949494;">, </span>1<span style="color: #949494;">, </span>1<span style="color: #949494;">, </span>1<span style="color: #949494;">, </span>1<span style="color: #949494;">, </span>1<span style="color: #949494;">, </span>1<span style="color: #949494;">, </span>1<span style="color: #949494;">, </span>1<span style="color: #949494;">, </span>1<span style="color: #949494;">, </span>1<span style="color: #949494;">, </span>1<span style="color: #949494;">, </span>1<span style="color: #949494;">,</span>…</span></span>
<span><span class="co">#&gt; $ age.cat          <span style="color: #949494; font-style: italic;">&lt;fct&gt;</span> "[30,35)"<span style="color: #949494;">, </span>"[20,25)"<span style="color: #949494;">, </span>"[40,45)"<span style="color: #949494;">, </span>"[25,30)"<span style="color: #949494;">, </span>"[25,30)"…</span></span>
<span><span class="co">#&gt; $ sex              <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span> "f"<span style="color: #949494;">, </span>"f"<span style="color: #949494;">, </span>"f"<span style="color: #949494;">, </span>"f"<span style="color: #949494;">, </span>"f"<span style="color: #949494;">, </span>"f"<span style="color: #949494;">, </span>"f"<span style="color: #949494;">, </span>"f"<span style="color: #949494;">, </span>"f"<span style="color: #949494;">, </span>"f"<span style="color: #949494;">, </span>"f"…</span></span>
<span><span class="co">#&gt; $ wwgt             <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> 1.057703<span style="color: #949494;">, </span>1.057703<span style="color: #949494;">, </span>1.057703<span style="color: #949494;">, </span>1.057703<span style="color: #949494;">, </span>1.057703<span style="color: #949494;">, </span>1.0…</span></span></code></pre></div>
<p>And here’s a long-form version of the sibling history data – there’s
one row for each reported sibling.</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://pillar.r-lib.org/reference/glimpse.html" class="external-link">glimpse</a></span><span class="op">(</span><span class="va">ex.sib</span><span class="op">)</span></span>
<span><span class="co">#&gt; Rows: 34,440</span></span>
<span><span class="co">#&gt; Columns: 27</span></span>
<span><span class="co">#&gt; $ .tmpid                      <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span> "        1  1  2"<span style="color: #949494;">, </span>"        1  3  2"<span style="color: #949494;">, </span>"   …</span></span>
<span><span class="co">#&gt; $ caseid                      <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span> "        1  1  2"<span style="color: #949494;">, </span>"        1  3  2"<span style="color: #949494;">, </span>"   …</span></span>
<span><span class="co">#&gt; $ wwgt                        <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> 1.057703<span style="color: #949494;">, </span>1.057703<span style="color: #949494;">, </span>1.057703<span style="color: #949494;">, </span>1.057703<span style="color: #949494;">, </span>1.…</span></span>
<span><span class="co">#&gt; $ psu                         <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> 1<span style="color: #949494;">, </span>1<span style="color: #949494;">, </span>1<span style="color: #949494;">, </span>1<span style="color: #949494;">, </span>1<span style="color: #949494;">, </span>1<span style="color: #949494;">, </span>1<span style="color: #949494;">, </span>1<span style="color: #949494;">, </span>1<span style="color: #949494;">, </span>1<span style="color: #949494;">, </span>1<span style="color: #949494;">, </span>1<span style="color: #949494;">, </span>1<span style="color: #949494;">, </span>1<span style="color: #949494;">, </span>…</span></span>
<span><span class="co">#&gt; $ doi                         <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> 1386<span style="color: #949494;">, </span>1386<span style="color: #949494;">, </span>1386<span style="color: #949494;">, </span>1386<span style="color: #949494;">, </span>1386<span style="color: #949494;">, </span>1386<span style="color: #949494;">, </span>1386<span style="color: #949494;">, </span>…</span></span>
<span><span class="co">#&gt; $ sex                         <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span> "f"<span style="color: #949494;">, </span>"f"<span style="color: #949494;">, </span>"f"<span style="color: #949494;">, </span>"f"<span style="color: #949494;">, </span>"f"<span style="color: #949494;">, </span>"f"<span style="color: #949494;">, </span>"f"<span style="color: #949494;">, </span>"f"<span style="color: #949494;">, </span>"f…</span></span>
<span><span class="co">#&gt; $ sibindex                    <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> 1<span style="color: #949494;">, </span>1<span style="color: #949494;">, </span>1<span style="color: #949494;">, </span>1<span style="color: #949494;">, </span>1<span style="color: #949494;">, </span>1<span style="color: #949494;">, </span>1<span style="color: #949494;">, </span>1<span style="color: #949494;">, </span>1<span style="color: #949494;">, </span>1<span style="color: #949494;">, </span>1<span style="color: #949494;">, </span>1<span style="color: #949494;">, </span>1<span style="color: #949494;">, </span>1<span style="color: #949494;">, </span>…</span></span>
<span><span class="co">#&gt; $ sib.sex                     <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span> "m"<span style="color: #949494;">, </span>"f"<span style="color: #949494;">, </span>"m"<span style="color: #949494;">, </span>"f"<span style="color: #949494;">, </span>"m"<span style="color: #949494;">, </span>"f"<span style="color: #949494;">, </span>"m"<span style="color: #949494;">, </span>"f"<span style="color: #949494;">, </span>"m…</span></span>
<span><span class="co">#&gt; $ sib.alive                   <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> 1<span style="color: #949494;">, </span>1<span style="color: #949494;">, </span>1<span style="color: #949494;">, </span>1<span style="color: #949494;">, </span>1<span style="color: #949494;">, </span>1<span style="color: #949494;">, </span>1<span style="color: #949494;">, </span>1<span style="color: #949494;">, </span>1<span style="color: #949494;">, </span>1<span style="color: #949494;">, </span>1<span style="color: #949494;">, </span>0<span style="color: #949494;">, </span>0<span style="color: #949494;">, </span>1<span style="color: #949494;">, </span>…</span></span>
<span><span class="co">#&gt; $ sib.age                     <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> 42<span style="color: #949494;">, </span>27<span style="color: #949494;">, </span>46<span style="color: #949494;">, </span>33<span style="color: #949494;">, </span>40<span style="color: #949494;">, </span>49<span style="color: #949494;">, </span>22<span style="color: #949494;">, </span>30<span style="color: #949494;">, </span>49<span style="color: #949494;">, </span>50<span style="color: #949494;">, </span>35…</span></span>
<span><span class="co">#&gt; $ sib.dob                     <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> 876<span style="color: #949494;">, </span>1056<span style="color: #949494;">, </span>828<span style="color: #949494;">, </span>984<span style="color: #949494;">, </span>900<span style="color: #949494;">, </span>792<span style="color: #949494;">, </span>1116<span style="color: #949494;">, </span>1020<span style="color: #949494;">,</span>…</span></span>
<span><span class="co">#&gt; $ sib.marital.status          <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #BB0000;">NA</span><span style="color: #949494;">, </span><span style="color: #BB0000;">NA</span><span style="color: #949494;">, </span><span style="color: #BB0000;">NA</span><span style="color: #949494;">, </span><span style="color: #BB0000;">NA</span><span style="color: #949494;">, </span><span style="color: #BB0000;">NA</span><span style="color: #949494;">, </span><span style="color: #BB0000;">NA</span><span style="color: #949494;">, </span><span style="color: #BB0000;">NA</span><span style="color: #949494;">, </span><span style="color: #BB0000;">NA</span><span style="color: #949494;">, </span><span style="color: #BB0000;">NA</span><span style="color: #949494;">, </span><span style="color: #BB0000;">NA</span><span style="color: #949494;">, </span><span style="color: #BB0000;">NA</span>…</span></span>
<span><span class="co">#&gt; $ sib.death.yrsago            <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #BB0000;">NA</span><span style="color: #949494;">, </span><span style="color: #BB0000;">NA</span><span style="color: #949494;">, </span><span style="color: #BB0000;">NA</span><span style="color: #949494;">, </span><span style="color: #BB0000;">NA</span><span style="color: #949494;">, </span><span style="color: #BB0000;">NA</span><span style="color: #949494;">, </span><span style="color: #BB0000;">NA</span><span style="color: #949494;">, </span><span style="color: #BB0000;">NA</span><span style="color: #949494;">, </span><span style="color: #BB0000;">NA</span><span style="color: #949494;">, </span><span style="color: #BB0000;">NA</span><span style="color: #949494;">, </span><span style="color: #BB0000;">NA</span><span style="color: #949494;">, </span><span style="color: #BB0000;">NA</span>…</span></span>
<span><span class="co">#&gt; $ sib.death.age               <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #BB0000;">NA</span><span style="color: #949494;">, </span><span style="color: #BB0000;">NA</span><span style="color: #949494;">, </span><span style="color: #BB0000;">NA</span><span style="color: #949494;">, </span><span style="color: #BB0000;">NA</span><span style="color: #949494;">, </span><span style="color: #BB0000;">NA</span><span style="color: #949494;">, </span><span style="color: #BB0000;">NA</span><span style="color: #949494;">, </span><span style="color: #BB0000;">NA</span><span style="color: #949494;">, </span><span style="color: #BB0000;">NA</span><span style="color: #949494;">, </span><span style="color: #BB0000;">NA</span><span style="color: #949494;">, </span><span style="color: #BB0000;">NA</span><span style="color: #949494;">, </span><span style="color: #BB0000;">NA</span>…</span></span>
<span><span class="co">#&gt; $ sib.death.date              <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> -1<span style="color: #949494;">, </span>-1<span style="color: #949494;">, </span>-1<span style="color: #949494;">, </span>-1<span style="color: #949494;">, </span>-1<span style="color: #949494;">, </span>-1<span style="color: #949494;">, </span>-1<span style="color: #949494;">, </span>-1<span style="color: #949494;">, </span>-1<span style="color: #949494;">, </span>-1<span style="color: #949494;">, </span>-1…</span></span>
<span><span class="co">#&gt; $ sib.died.pregnant           <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #BB0000;">NA</span><span style="color: #949494;">, </span><span style="color: #BB0000;">NA</span><span style="color: #949494;">, </span><span style="color: #BB0000;">NA</span><span style="color: #949494;">, </span><span style="color: #BB0000;">NA</span><span style="color: #949494;">, </span><span style="color: #BB0000;">NA</span><span style="color: #949494;">, </span><span style="color: #BB0000;">NA</span><span style="color: #949494;">, </span><span style="color: #BB0000;">NA</span><span style="color: #949494;">, </span><span style="color: #BB0000;">NA</span><span style="color: #949494;">, </span><span style="color: #BB0000;">NA</span><span style="color: #949494;">, </span><span style="color: #BB0000;">NA</span><span style="color: #949494;">, </span><span style="color: #BB0000;">NA</span>…</span></span>
<span><span class="co">#&gt; $ sib.died.bc.pregnancy       <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #BB0000;">NA</span><span style="color: #949494;">, </span><span style="color: #BB0000;">NA</span><span style="color: #949494;">, </span><span style="color: #BB0000;">NA</span><span style="color: #949494;">, </span><span style="color: #BB0000;">NA</span><span style="color: #949494;">, </span><span style="color: #BB0000;">NA</span><span style="color: #949494;">, </span><span style="color: #BB0000;">NA</span><span style="color: #949494;">, </span><span style="color: #BB0000;">NA</span><span style="color: #949494;">, </span><span style="color: #BB0000;">NA</span><span style="color: #949494;">, </span><span style="color: #BB0000;">NA</span><span style="color: #949494;">, </span><span style="color: #BB0000;">NA</span><span style="color: #949494;">, </span><span style="color: #BB0000;">NA</span>…</span></span>
<span><span class="co">#&gt; $ sib.death.cause             <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #BB0000;">NA</span><span style="color: #949494;">, </span><span style="color: #BB0000;">NA</span><span style="color: #949494;">, </span><span style="color: #BB0000;">NA</span><span style="color: #949494;">, </span><span style="color: #BB0000;">NA</span><span style="color: #949494;">, </span><span style="color: #BB0000;">NA</span><span style="color: #949494;">, </span><span style="color: #BB0000;">NA</span><span style="color: #949494;">, </span><span style="color: #BB0000;">NA</span><span style="color: #949494;">, </span><span style="color: #BB0000;">NA</span><span style="color: #949494;">, </span><span style="color: #BB0000;">NA</span><span style="color: #949494;">, </span><span style="color: #BB0000;">NA</span><span style="color: #949494;">, </span><span style="color: #BB0000;">NA</span>…</span></span>
<span><span class="co">#&gt; $ sib.time.delivery.death     <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #BB0000;">NA</span><span style="color: #949494;">, </span><span style="color: #BB0000;">NA</span><span style="color: #949494;">, </span><span style="color: #BB0000;">NA</span><span style="color: #949494;">, </span><span style="color: #BB0000;">NA</span><span style="color: #949494;">, </span><span style="color: #BB0000;">NA</span><span style="color: #949494;">, </span><span style="color: #BB0000;">NA</span><span style="color: #949494;">, </span><span style="color: #BB0000;">NA</span><span style="color: #949494;">, </span><span style="color: #BB0000;">NA</span><span style="color: #949494;">, </span><span style="color: #BB0000;">NA</span><span style="color: #949494;">, </span><span style="color: #BB0000;">NA</span><span style="color: #949494;">, </span><span style="color: #BB0000;">NA</span>…</span></span>
<span><span class="co">#&gt; $ sib.place.death             <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #BB0000;">NA</span><span style="color: #949494;">, </span><span style="color: #BB0000;">NA</span><span style="color: #949494;">, </span><span style="color: #BB0000;">NA</span><span style="color: #949494;">, </span><span style="color: #BB0000;">NA</span><span style="color: #949494;">, </span><span style="color: #BB0000;">NA</span><span style="color: #949494;">, </span><span style="color: #BB0000;">NA</span><span style="color: #949494;">, </span><span style="color: #BB0000;">NA</span><span style="color: #949494;">, </span><span style="color: #BB0000;">NA</span><span style="color: #949494;">, </span><span style="color: #BB0000;">NA</span><span style="color: #949494;">, </span><span style="color: #BB0000;">NA</span><span style="color: #949494;">, </span><span style="color: #BB0000;">NA</span>…</span></span>
<span><span class="co">#&gt; $ sib.num.children            <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #BB0000;">NA</span><span style="color: #949494;">, </span><span style="color: #BB0000;">NA</span><span style="color: #949494;">, </span><span style="color: #BB0000;">NA</span><span style="color: #949494;">, </span><span style="color: #BB0000;">NA</span><span style="color: #949494;">, </span><span style="color: #BB0000;">NA</span><span style="color: #949494;">, </span><span style="color: #BB0000;">NA</span><span style="color: #949494;">, </span><span style="color: #BB0000;">NA</span><span style="color: #949494;">, </span><span style="color: #BB0000;">NA</span><span style="color: #949494;">, </span><span style="color: #BB0000;">NA</span><span style="color: #949494;">, </span><span style="color: #BB0000;">NA</span><span style="color: #949494;">, </span><span style="color: #BB0000;">NA</span>…</span></span>
<span><span class="co">#&gt; $ sib.death.year              <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #BB0000;">NA</span><span style="color: #949494;">, </span><span style="color: #BB0000;">NA</span><span style="color: #949494;">, </span><span style="color: #BB0000;">NA</span><span style="color: #949494;">, </span><span style="color: #BB0000;">NA</span><span style="color: #949494;">, </span><span style="color: #BB0000;">NA</span><span style="color: #949494;">, </span><span style="color: #BB0000;">NA</span><span style="color: #949494;">, </span><span style="color: #BB0000;">NA</span><span style="color: #949494;">, </span><span style="color: #BB0000;">NA</span><span style="color: #949494;">, </span><span style="color: #BB0000;">NA</span><span style="color: #949494;">, </span><span style="color: #BB0000;">NA</span><span style="color: #949494;">, </span><span style="color: #BB0000;">NA</span>…</span></span>
<span><span class="co">#&gt; $ alternum                    <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span> "01"<span style="color: #949494;">, </span>"01"<span style="color: #949494;">, </span>"01"<span style="color: #949494;">, </span>"01"<span style="color: #949494;">, </span>"01"<span style="color: #949494;">, </span>"01"<span style="color: #949494;">, </span>"01"<span style="color: #949494;">, </span>…</span></span>
<span><span class="co">#&gt; $ sib.endobs                  <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> 1386<span style="color: #949494;">, </span>1386<span style="color: #949494;">, </span>1386<span style="color: #949494;">, </span>1386<span style="color: #949494;">, </span>1386<span style="color: #949494;">, </span>1386<span style="color: #949494;">, </span>1386<span style="color: #949494;">, </span>…</span></span>
<span><span class="co">#&gt; $ sibid                       <span style="color: #949494; font-style: italic;">&lt;int&gt;</span> 1<span style="color: #949494;">, </span>2<span style="color: #949494;">, </span>3<span style="color: #949494;">, </span>4<span style="color: #949494;">, </span>5<span style="color: #949494;">, </span>6<span style="color: #949494;">, </span>7<span style="color: #949494;">, </span>8<span style="color: #949494;">, </span>9<span style="color: #949494;">, </span>10<span style="color: #949494;">, </span>11<span style="color: #949494;">, </span>12<span style="color: #949494;">, </span>13<span style="color: #949494;">,</span>…</span></span>
<span><span class="co">#&gt; $ sib.preg_related.death.date <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #BB0000;">NA</span><span style="color: #949494;">, </span>-1<span style="color: #949494;">, </span><span style="color: #BB0000;">NA</span><span style="color: #949494;">, </span>-1<span style="color: #949494;">, </span><span style="color: #BB0000;">NA</span><span style="color: #949494;">, </span>-1<span style="color: #949494;">, </span><span style="color: #BB0000;">NA</span><span style="color: #949494;">, </span>-1<span style="color: #949494;">, </span><span style="color: #BB0000;">NA</span><span style="color: #949494;">, </span><span style="color: #BB0000;">NA</span><span style="color: #949494;">, </span>-1…</span></span>
<span><span class="co">#&gt; $ sib.maternal.death.date     <span style="color: #949494; font-style: italic;">&lt;lgl&gt;</span> <span style="color: #BB0000;">NA</span><span style="color: #949494;">, </span><span style="color: #BB0000;">NA</span><span style="color: #949494;">, </span><span style="color: #BB0000;">NA</span><span style="color: #949494;">, </span><span style="color: #BB0000;">NA</span><span style="color: #949494;">, </span><span style="color: #BB0000;">NA</span><span style="color: #949494;">, </span><span style="color: #BB0000;">NA</span><span style="color: #949494;">, </span><span style="color: #BB0000;">NA</span><span style="color: #949494;">, </span><span style="color: #BB0000;">NA</span><span style="color: #949494;">, </span><span style="color: #BB0000;">NA</span><span style="color: #949494;">, </span><span style="color: #BB0000;">NA</span><span style="color: #949494;">, </span><span style="color: #BB0000;">NA</span>…</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="laying-the-groundwork">Laying the groundwork<a class="anchor" aria-label="anchor" href="#laying-the-groundwork"></a>
</h3>
<p>First, we’ll need to add an indicator variable for each sibling’s
frame population membership. In other words, we need to create a
variable that has the value 1 for each sibling who was eligible to
respond to the survey, and 0 otherwise. In this example data, we’ll
assume that conditions similar to a typical DHS survey hold: i.e., we’ll
assume the survey design was such that siblings would have been eligible
to respond if they</p>
<ul>
<li>are alive</li>
<li>are female</li>
<li>are between the ages of 15 and 49</li>
</ul>
<p>For a given survey, these criteria will differ. You’ll have to find
out what the criteria for inclusion in the frame population were in
order to produce estimates from sibling histories.</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">ex.sib</span> <span class="op">&lt;-</span> <span class="va">ex.sib</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>in.F <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/numeric.html" class="external-link">as.numeric</a></span><span class="op">(</span><span class="op">(</span><span class="va">sib.alive</span><span class="op">==</span><span class="fl">1</span><span class="op">)</span> <span class="op">&amp;</span> <span class="op">(</span><span class="va">sib.age</span> <span class="op">&gt;=</span> <span class="fl">15</span><span class="op">)</span> <span class="op">&amp;</span> <span class="op">(</span><span class="va">sib.age</span> <span class="op">&lt;=</span> <span class="fl">49</span><span class="op">)</span> <span class="op">&amp;</span> <span class="op">(</span><span class="va">sib.sex</span> <span class="op">==</span> <span class="st">'f'</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p>Let’s look at the distribution of frame population membership</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/with.html" class="external-link">with</a></span><span class="op">(</span><span class="va">ex.sib</span>, <span class="fu"><a href="https://rdrr.io/r/base/table.html" class="external-link">table</a></span><span class="op">(</span><span class="va">in.F</span>, useNA<span class="op">=</span><span class="st">'ifany'</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt; in.F</span></span>
<span><span class="co">#&gt;     0     1  &lt;NA&gt; </span></span>
<span><span class="co">#&gt; 22826 11513   101</span></span></code></pre></div>
<p>In this example dataset, a small number of the <code>in.F</code>
values is missing. (In a real dataset, there could well be more.) Since
we need to be able to determine whether or not each sibling is on in the
frame population, we would drop siblings missing <code>in.F</code>
values from the analysis.</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">ex.sib</span> <span class="op">&lt;-</span> <span class="va">ex.sib</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="op">!</span> <span class="fu"><a href="https://rdrr.io/r/base/NA.html" class="external-link">is.na</a></span><span class="op">(</span><span class="va">in.F</span><span class="op">)</span><span class="op">)</span> </span></code></pre></div>
<p>Finally, since we will focus on pregnancy-related deaths in this
vignette, we will drop all of the male sibs. We’ll also only keep female
sibs up to age 49.</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">ex.sib</span> <span class="op">&lt;-</span> <span class="va">ex.sib</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">sib.sex</span> <span class="op">==</span> <span class="st">'f'</span><span class="op">)</span> </span></code></pre></div>
</div>
<div class="section level3">
<h3 id="specifying-cells">Specifying cells<a class="anchor" aria-label="anchor" href="#specifying-cells"></a>
</h3>
<p>When we produce estimated maternal death rates from sibling
histories, we usually do so for different sex X age group X time period
combinations. These are called <em>cells</em>.</p>
<p>Our next step is to create an object that describes the cells that we
plan to produce death rate estimates for. This means we need to specify
the time period and age groups that we’ll be using. We’ll use the helper
function <code>cell_config</code> to do this:</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">cc_pr</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/cell_config.html">cell_config</a></span><span class="op">(</span>age.groups<span class="op">=</span><span class="st">'5yr'</span>, </span>
<span>                     time.periods<span class="op">=</span><span class="st">'7yr_beforeinterview'</span>,</span>
<span>                     start.obs<span class="op">=</span><span class="st">'sib.dob'</span>,    <span class="co"># date of birth</span></span>
<span>                     end.obs<span class="op">=</span><span class="st">'sib.endobs'</span>,   <span class="co"># either the date respondent was interviewed (if sib is alive) or date of death (if sib is dead)</span></span>
<span>                     event<span class="op">=</span><span class="st">'sib.preg_related.death.date'</span>, <span class="co"># date of death (for sibs who died of maternal causes)</span></span>
<span>                     age.offset<span class="op">=</span><span class="st">'sib.dob'</span>,   <span class="co"># date of birth</span></span>
<span>                     time.offset<span class="op">=</span><span class="st">'doi'</span>,      <span class="co"># date of interview</span></span>
<span>                     event.name<span class="op">=</span><span class="st">'pr_death'</span>,  <span class="co"># pregnancy-related death</span></span>
<span>                     exp.scale<span class="op">=</span><span class="fl">1</span><span class="op">/</span><span class="fl">12</span><span class="op">)</span></span></code></pre></div>
<p>We’re specifying that we want</p>
<ul>
<li>5-year age groups, starting from 15 and ending at 65</li>
<li>to produce estimates for the 7-year window before each survey
interview (so, slightly different for each respondent)</li>
<li>the <code>dob</code> column of our sibling dataset has the time
siblings start being observed (their birthdate)</li>
<li>the <code>endobs</code> column of our sibling dataset has the time
siblings stop being observed (the interview or, if they’re dead, the
date of death)</li>
<li>the <code>sib.preg_related.death.date</code> column of our sibling
dataset has the date the sibling death is considered pregnancy-related
(for maternal causes, we would use <code>sib.maternal.death.date</code>,
but this is not available for many DHS surveys)</li>
<li>the <code>doi</code> column of our sibling dataset has the date the
respondent who reported about the sibling was interviewed</li>
<li>in our survey, times are counted in months, so we set
<code>exp.scale=1/12</code> to indicate that we need to divide total
exposures by 12 to get years</li>
</ul>
</div>
<div class="section level3">
<h3 id="estimating-pregnancy-related-death-rates">Estimating pregnancy-related death rates<a class="anchor" aria-label="anchor" href="#estimating-pregnancy-related-death-rates"></a>
</h3>
<p>Given these preparatory steps, the <code>sibling_estimator</code>
function will take care of estimating pregnancy-related death rates from
the sibling histories for us.</p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">ex_ests</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/sibling_estimator.html">sibling_estimator</a></span><span class="op">(</span>sib.dat <span class="op">=</span> <span class="va">ex.sib</span>,</span>
<span>                             ego.id <span class="op">=</span> <span class="st">'caseid'</span>,            <span class="co"># column with the respondent id</span></span>
<span>                             sib.id <span class="op">=</span> <span class="st">'sibid'</span>,             <span class="co"># column with sibling id </span></span>
<span>                                                           <span class="co"># (unique for each reported sibling)</span></span>
<span>                             sib.frame.indicator <span class="op">=</span> <span class="st">'in.F'</span>, <span class="co"># indicator for sibling frame population membership</span></span>
<span>                             sib.sex <span class="op">=</span> <span class="st">'sib.sex'</span>,          <span class="co"># column with sibling's sex</span></span>
<span>                             cell.config<span class="op">=</span><span class="va">cc_pr</span>,            <span class="co"># cell configuration we created above</span></span>
<span>                             weights<span class="op">=</span><span class="st">'wwgt'</span><span class="op">)</span>               <span class="co"># column with the respondents' sampling weights</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">ex_ests</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] "asdr.ind" "asdr.agg" "ec.dat"   "esc.dat"</span></span></code></pre></div>
<p><code>sibling_estimator</code> returns a list with the results. We’ll
focus on <code>asdr.ind</code>, which has the individual visibility
estimates, and <code>asdr.agg</code>, which has the aggregate visibility
estimates.</p>
<p>Here are the individual visibility estimates:</p>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">ex_ests</span><span class="op">$</span><span class="va">asdr.ind</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 10 × 11</span></span></span>
<span><span class="co">#&gt;    time.period  sib.sex sib.age num.hat denom.hat ind.y.F     n wgt.sum asdr.hat</span></span>
<span><span class="co">#&gt;    <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>        <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>   <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>     <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>     <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>   <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;int&gt;</span>   <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>    <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 1</span> 7yr_beforei… f       [15,20)  15.5      <span style="text-decoration: underline;">7</span>724.   <span style="text-decoration: underline;">11</span>401.  <span style="text-decoration: underline;">6</span>864   <span style="text-decoration: underline;">6</span>798. 0.002<span style="text-decoration: underline;">00</span> </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 2</span> 7yr_beforei… f       [20,25)   9.46     <span style="text-decoration: underline;">7</span>932.   <span style="text-decoration: underline;">11</span>401.  <span style="text-decoration: underline;">6</span>864   <span style="text-decoration: underline;">6</span>798. 0.001<span style="text-decoration: underline;">19</span> </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 3</span> 7yr_beforei… f       [25,30)   7.17     <span style="text-decoration: underline;">6</span>980.   <span style="text-decoration: underline;">11</span>401.  <span style="text-decoration: underline;">6</span>864   <span style="text-decoration: underline;">6</span>798. 0.001<span style="text-decoration: underline;">03</span> </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 4</span> 7yr_beforei… f       [30,35)  12.9      <span style="text-decoration: underline;">5</span>549.   <span style="text-decoration: underline;">11</span>401.  <span style="text-decoration: underline;">6</span>864   <span style="text-decoration: underline;">6</span>798. 0.002<span style="text-decoration: underline;">33</span> </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 5</span> 7yr_beforei… f       [35,40)   5.94     <span style="text-decoration: underline;">4</span>336.   <span style="text-decoration: underline;">11</span>401.  <span style="text-decoration: underline;">6</span>864   <span style="text-decoration: underline;">6</span>798. 0.001<span style="text-decoration: underline;">37</span> </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 6</span> 7yr_beforei… f       [40,45)   1.63     <span style="text-decoration: underline;">2</span>746.   <span style="text-decoration: underline;">11</span>401.  <span style="text-decoration: underline;">6</span>864   <span style="text-decoration: underline;">6</span>798. 0.000<span style="text-decoration: underline;">594</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 7</span> 7yr_beforei… f       [45,50)   0        <span style="text-decoration: underline;">1</span>752.   <span style="text-decoration: underline;">11</span>401.  <span style="text-decoration: underline;">6</span>864   <span style="text-decoration: underline;">6</span>798. 0       </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 8</span> 7yr_beforei… f       [50,55)   0.758     987.   <span style="text-decoration: underline;">11</span>401.  <span style="text-decoration: underline;">6</span>864   <span style="text-decoration: underline;">6</span>798. 0.000<span style="text-decoration: underline;">768</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 9</span> 7yr_beforei… f       [55,60)   0         422.   <span style="text-decoration: underline;">11</span>401.  <span style="text-decoration: underline;">6</span>864   <span style="text-decoration: underline;">6</span>798. 0       </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">10</span> 7yr_beforei… f       [60,65)   0          88.1  <span style="text-decoration: underline;">11</span>401.  <span style="text-decoration: underline;">6</span>864   <span style="text-decoration: underline;">6</span>798. 0       </span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># ℹ 2 more variables: estimator &lt;chr&gt;, event.name &lt;chr&gt;</span></span></span></code></pre></div>
<p>And here are the aggregate visibility estimates</p>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">ex_ests</span><span class="op">$</span><span class="va">asdr.agg</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 10 × 10</span></span></span>
<span><span class="co">#&gt;    time.period   sib.sex sib.age num.hat denom.hat     n wgt.sum asdr.hat</span></span>
<span><span class="co">#&gt;    <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>         <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>   <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>     <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>     <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;int&gt;</span>   <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>    <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 1</span> 7yr_beforeint f       [15,20)  29.2      <span style="text-decoration: underline;">14</span>696.  <span style="text-decoration: underline;">6</span>864   <span style="text-decoration: underline;">6</span>798. 0.001<span style="text-decoration: underline;">99</span> </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 2</span> 7yr_beforeint f       [20,25)  24.1      <span style="text-decoration: underline;">15</span>949.  <span style="text-decoration: underline;">6</span>864   <span style="text-decoration: underline;">6</span>798. 0.001<span style="text-decoration: underline;">51</span> </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 3</span> 7yr_beforeint f       [25,30)  18.2      <span style="text-decoration: underline;">14</span>467.  <span style="text-decoration: underline;">6</span>864   <span style="text-decoration: underline;">6</span>798. 0.001<span style="text-decoration: underline;">26</span> </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 4</span> 7yr_beforeint f       [30,35)  22.8      <span style="text-decoration: underline;">11</span>597.  <span style="text-decoration: underline;">6</span>864   <span style="text-decoration: underline;">6</span>798. 0.001<span style="text-decoration: underline;">97</span> </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 5</span> 7yr_beforeint f       [35,40)  12.8       <span style="text-decoration: underline;">8</span>852.  <span style="text-decoration: underline;">6</span>864   <span style="text-decoration: underline;">6</span>798. 0.001<span style="text-decoration: underline;">44</span> </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 6</span> 7yr_beforeint f       [40,45)   2.61      <span style="text-decoration: underline;">5</span>321.  <span style="text-decoration: underline;">6</span>864   <span style="text-decoration: underline;">6</span>798. 0.000<span style="text-decoration: underline;">491</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 7</span> 7yr_beforeint f       [45,50)   0         <span style="text-decoration: underline;">3</span>066.  <span style="text-decoration: underline;">6</span>864   <span style="text-decoration: underline;">6</span>798. 0       </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 8</span> 7yr_beforeint f       [50,55)   0.758     <span style="text-decoration: underline;">1</span>573.  <span style="text-decoration: underline;">6</span>864   <span style="text-decoration: underline;">6</span>798. 0.000<span style="text-decoration: underline;">482</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 9</span> 7yr_beforeint f       [55,60)   0          609.  <span style="text-decoration: underline;">6</span>864   <span style="text-decoration: underline;">6</span>798. 0       </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">10</span> 7yr_beforeint f       [60,65)   0          111.  <span style="text-decoration: underline;">6</span>864   <span style="text-decoration: underline;">6</span>798. 0       </span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># ℹ 2 more variables: estimator &lt;chr&gt;, event.name &lt;chr&gt;</span></span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="plotting-the-results">Plotting the results<a class="anchor" aria-label="anchor" href="#plotting-the-results"></a>
</h3>
<p>We’ll make some plots showing the results. We’ll only show results up
to age 50, which is typically how pregnancy-related mortality is
analyzed.</p>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="va">ex_ests</span><span class="op">$</span><span class="va">asdr.ind</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="op">!</span> <span class="va">sib.age</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"[50,55)"</span>, <span class="st">"[55,60)"</span>, <span class="st">"[60,65)"</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html" class="external-link">geom_line</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x<span class="op">=</span><span class="va">sib.age</span>, y<span class="op">=</span><span class="fl">1000</span><span class="op">*</span><span class="va">asdr.hat</span>, group<span class="op">=</span><span class="va">sib.sex</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html" class="external-link">theme_minimal</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_continuous.html" class="external-link">scale_y_log10</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">ylab</a></span><span class="op">(</span><span class="st">"1,000 X PRMR"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">ggtitle</a></span><span class="op">(</span><span class="st">'individual visibility estimator\npregnancy-related mortality, 7yr before survey'</span><span class="op">)</span></span>
<span><span class="co">#&gt; Warning in scale_y_log10(): <span style="color: #00BB00;">log-10</span> transformation introduced</span></span>
<span><span class="co">#&gt; infinite values.</span></span></code></pre></div>
<p><img src="maternal-estimates_files/figure-html/unnamed-chunk-14-1.png" class="r-plt" width="700"></p>
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="va">ex_ests</span><span class="op">$</span><span class="va">asdr.agg</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="op">!</span> <span class="va">sib.age</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"[50,55)"</span>, <span class="st">"[55,60)"</span>, <span class="st">"[60,65)"</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html" class="external-link">geom_line</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x<span class="op">=</span><span class="va">sib.age</span>, y<span class="op">=</span><span class="fl">1000</span><span class="op">*</span><span class="va">asdr.hat</span>, group<span class="op">=</span><span class="va">sib.sex</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html" class="external-link">theme_minimal</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_continuous.html" class="external-link">scale_y_log10</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">ylab</a></span><span class="op">(</span><span class="st">"1,000 X PRMR"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">ggtitle</a></span><span class="op">(</span><span class="st">'aggregate visibility estimator\npregnancy-related mortality, 7yr before survey'</span><span class="op">)</span></span>
<span><span class="co">#&gt; Warning in scale_y_log10(): <span style="color: #00BB00;">log-10</span> transformation introduced</span></span>
<span><span class="co">#&gt; infinite values.</span></span></code></pre></div>
<p><img src="maternal-estimates_files/figure-html/unnamed-chunk-15-1.png" class="r-plt" width="700"></p>
<div class="sourceCode" id="cb16"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">compare</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/bind_rows.html" class="external-link">bind_rows</a></span><span class="op">(</span><span class="va">ex_ests</span><span class="op">$</span><span class="va">asdr.ind</span>, <span class="va">ex_ests</span><span class="op">$</span><span class="va">asdr.agg</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="va">compare</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="op">!</span> <span class="va">sib.age</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"[50,55)"</span>, <span class="st">"[55,60)"</span>, <span class="st">"[60,65)"</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html" class="external-link">geom_line</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x<span class="op">=</span><span class="va">sib.age</span>, y<span class="op">=</span><span class="fl">1000</span><span class="op">*</span><span class="va">asdr.hat</span>, linetype<span class="op">=</span><span class="va">estimator</span>, group<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/interaction.html" class="external-link">interaction</a></span><span class="op">(</span><span class="va">estimator</span>, <span class="va">sib.sex</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html" class="external-link">theme_minimal</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="co">#facet_grid(sex ~ .) +</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/facet_grid.html" class="external-link">facet_grid</a></span><span class="op">(</span><span class="va">.</span> <span class="op">~</span> <span class="va">sib.sex</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_continuous.html" class="external-link">scale_y_log10</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">ylab</a></span><span class="op">(</span><span class="st">"1,000 X PRMR"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">ggtitle</a></span><span class="op">(</span><span class="st">'both estimators\npregnancy-related mortality, 7yr before survey'</span><span class="op">)</span></span>
<span><span class="co">#&gt; Warning in scale_y_log10(): <span style="color: #00BB00;">log-10</span> transformation introduced</span></span>
<span><span class="co">#&gt; infinite values.</span></span></code></pre></div>
<p><img src="maternal-estimates_files/figure-html/unnamed-chunk-16-1.png" class="r-plt" width="700"></p>
</div>
</div>
<div class="section level2">
<h2 id="aggregating-estimates-across-ages">Aggregating estimates across ages<a class="anchor" aria-label="anchor" href="#aggregating-estimates-across-ages"></a>
</h2>
<p>Problem: ex.sib doesn’t have column age.cat</p>
<div class="sourceCode" id="cb17"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">mmrate</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/aggregate_maternal_estimates.html">aggregate_maternal_estimates</a></span><span class="op">(</span><span class="va">ex_ests</span>, <span class="va">ex.ego</span>, <span class="va">ex.sib</span><span class="op">)</span></span>
<span><span class="co">#&gt; Joining with `by = join_by(.ego.id, .weight, sex)`</span></span>
<span><span class="co">#&gt; Joining with `by = join_by(time.period, sib.sex, sib.age, event.name)`</span></span>
<span><span class="va">mmrate</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 1 × 7</span></span></span>
<span><span class="co">#&gt;   ind.est agg.est adj.factor adj.factor.allage adj.factor.meanagespec</span></span>
<span><span class="co">#&gt;     <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>   <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>      <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>             <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>                  <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">1</span> 0.001<span style="text-decoration: underline;">38</span> 0.001<span style="text-decoration: underline;">43</span>      0.430             0.577                  0.573</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># ℹ 2 more variables: ratio.agg.ind &lt;dbl&gt;, ratio.ind.agg &lt;dbl&gt;</span></span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="variance-estimates">Variance estimates<a class="anchor" aria-label="anchor" href="#variance-estimates"></a>
</h2>
<p>In practice, we want point estimates and estimated sampling
uncertainty for the death rates. We’ll use the rescaled bootstrap to
estimate sampling uncertainty. This can be done with the
<code>surveybootstrap</code> package.</p>
<p>Before we use the rescaled bootstrap, we need to know a little bit
about the sampling design of the survey we’re working with. In this
example dataset, we have a stratified, multistage design. So we’ll need
to tell the bootstrap function about the strata and the primary sampling
units. In this example data, these are indicated by the ‘stratum’ and
‘psu’ columns of the dataset.</p>
<p>(NOTE: this takes about a minute or so on a 2018 MBP for 1000
resamples.)</p>
<div class="sourceCode" id="cb18"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/Random.html" class="external-link">set.seed</a></span><span class="op">(</span><span class="fl">101010</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/pkg/tictoc/man/tic.html" class="external-link">tic</a></span><span class="op">(</span><span class="st">'running bootstrap'</span><span class="op">)</span></span>
<span><span class="co">## this will take a little while -- for 1000 reps, it takes about 10 minutes on a 2018 Macbook Pro</span></span>
<span><span class="co">#num.boot.reps &lt;- 1000</span></span>
<span><span class="co"># reduce number of reps to help vignette build faster</span></span>
<span><span class="va">num.boot.reps</span> <span class="op">&lt;-</span> <span class="fl">100</span></span>
<span></span>
<span></span>
<span><span class="co"># The Guide to DHS Statistics DHS-8</span></span>
<span><span class="co"># suggests using what we call the `stratum_design` variable</span></span>
<span><span class="co"># (v023) in calculating sampling-based standard errors</span></span>
<span><span class="va">bootweights</span> <span class="op">&lt;-</span> <span class="fu">surveybootstrap</span><span class="fu">::</span><span class="fu"><a href="http://dennisfeehan.org/surveybootstrap/reference/rescaled.bootstrap.weights.html" class="external-link">rescaled.bootstrap.weights</a></span><span class="op">(</span>survey.design <span class="op">=</span> <span class="op">~</span> <span class="va">psu</span> <span class="op">+</span> <span class="fu">strata</span><span class="op">(</span><span class="va">stratum_design</span><span class="op">)</span>,</span>
<span>                                                           <span class="co"># a high number is good here, though that will obviously</span></span>
<span>                                                           <span class="co"># make everything take longer</span></span>
<span>                                                           num.reps<span class="op">=</span><span class="va">num.boot.reps</span>,</span>
<span>                                                           idvar<span class="op">=</span><span class="st">'caseid'</span>,       <span class="co"># column with the respondent ids</span></span>
<span>                                                           weights<span class="op">=</span><span class="st">'wwgt'</span>, <span class="co"># column with the sampling weight</span></span>
<span>                                                           survey.data<span class="op">=</span><span class="va">ex.ego</span>    <span class="co"># note that we pass in the respondent data, NOT the sibling data</span></span>
<span>                                                           <span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/pkg/tictoc/man/tic.html" class="external-link">toc</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="co">#&gt; running bootstrap: 0.358 sec elapsed</span></span></code></pre></div>
<p>The result, <code>bootweights</code>, is a dataframe that has a row
for each survey respondent, a column for the survey respondent’s ID, and
then <code>num.boot.reps</code> columns containing survey weights that
result from the bootstrap procedure. The basic idea is to calculate
estimated death rates using each one of the <code>num.boot.reps</code>
sets of weights. The variation across the estimates is then an estimator
for the sampling variation.</p>
<p>To make this easier, the <code>sibling_estimator</code> function can
take a dataset with bootstrap resampled weights; it will then calculate
and summarize the estimates for you.</p>
<p>(NOTE: this is slow; it takes about 35 minutes or so on a 2018 MBP
when <code>bootweights</code> has 1000 resamples.)</p>
<div class="sourceCode" id="cb19"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># to save time, we'll only use a subset of the bootstrap replicates</span></span>
<span></span>
<span><span class="va">short.bootweights</span> <span class="op">&lt;-</span> <span class="va">bootweights</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fl">11</span><span class="op">)</span></span>
<span></span>
<span><span class="co">#est.bootweights &lt;- bootweights</span></span>
<span><span class="va">est.bootweights</span> <span class="op">&lt;-</span> <span class="va">short.bootweights</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/pkg/tictoc/man/tic.html" class="external-link">tic</a></span><span class="op">(</span><span class="st">'calculating estimates with bootstrap'</span><span class="op">)</span></span>
<span><span class="va">ex_boot_ests</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/sibling_estimator.html">sibling_estimator</a></span><span class="op">(</span>sib.dat <span class="op">=</span> <span class="va">ex.sib</span>,</span>
<span>                                  ego.id <span class="op">=</span> <span class="st">'caseid'</span>,</span>
<span>                                  sib.id <span class="op">=</span> <span class="st">'sibid'</span>,</span>
<span>                                  sib.frame.indicator <span class="op">=</span> <span class="st">'in.F'</span>,</span>
<span>                                  sib.sex <span class="op">=</span> <span class="st">'sib.sex'</span>,</span>
<span>                                  cell.config<span class="op">=</span><span class="va">cc_pr</span>,</span>
<span>                                  boot.weights<span class="op">=</span><span class="va">est.bootweights</span>,  <span class="co"># to get sampling uncertainty, we pass boot.weights into sibling_estimator</span></span>
<span>                                  return.boot<span class="op">=</span><span class="cn">TRUE</span>,                <span class="co"># when TRUE, return all of the resampled estimates (not just summaries)</span></span>
<span>                                  weights<span class="op">=</span><span class="st">'wwgt'</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/pkg/tictoc/man/tic.html" class="external-link">toc</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="co">#&gt; calculating estimates with bootstrap: 2.29 sec elapsed</span></span></code></pre></div>
<p>Finally, let’s plot the estimated death rates along with their
sampling uncertainty:</p>
<div class="sourceCode" id="cb20"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="va">ex_boot_ests</span><span class="op">$</span><span class="va">asdr.ind</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="op">!</span> <span class="va">sib.age</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"[50,55)"</span>, <span class="st">"[55,60)"</span>, <span class="st">"[60,65)"</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_ribbon.html" class="external-link">geom_ribbon</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x<span class="op">=</span><span class="va">sib.age</span>, ymin<span class="op">=</span><span class="fl">1000</span><span class="op">*</span><span class="va">asdr.hat.ci.low</span>, ymax<span class="op">=</span><span class="fl">1000</span><span class="op">*</span><span class="va">asdr.hat.ci.high</span>, group<span class="op">=</span><span class="va">sib.sex</span><span class="op">)</span>, alpha<span class="op">=</span><span class="fl">.2</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html" class="external-link">geom_line</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x<span class="op">=</span><span class="va">sib.age</span>, y<span class="op">=</span><span class="fl">1000</span><span class="op">*</span><span class="va">asdr.hat</span>, group<span class="op">=</span><span class="va">sib.sex</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html" class="external-link">theme_minimal</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_continuous.html" class="external-link">scale_y_log10</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">ylab</a></span><span class="op">(</span><span class="st">"1,000 X PRMR"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">ggtitle</a></span><span class="op">(</span><span class="st">'individual visibility estimator\npregnancy-related mortality, 7yr before survey'</span><span class="op">)</span></span>
<span><span class="co">#&gt; Warning in scale_y_log10(): <span style="color: #00BB00;">log-10</span> transformation introduced infinite values.</span></span>
<span><span class="co">#&gt; <span style="color: #00BB00;">log-10</span> transformation introduced infinite values.</span></span>
<span><span class="co">#&gt; <span style="color: #00BB00;">log-10</span> transformation introduced infinite values.</span></span></code></pre></div>
<p><img src="maternal-estimates_files/figure-html/unnamed-chunk-20-1.png" class="r-plt" width="700"></p>
<div class="sourceCode" id="cb21"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="va">ex_boot_ests</span><span class="op">$</span><span class="va">asdr.agg</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="op">!</span> <span class="va">sib.age</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"[50,55)"</span>, <span class="st">"[55,60)"</span>, <span class="st">"[60,65)"</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_ribbon.html" class="external-link">geom_ribbon</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x<span class="op">=</span><span class="va">sib.age</span>, ymin<span class="op">=</span><span class="fl">1000</span><span class="op">*</span><span class="va">asdr.hat.ci.low</span>, ymax<span class="op">=</span><span class="fl">1000</span><span class="op">*</span><span class="va">asdr.hat.ci.high</span>, group<span class="op">=</span><span class="va">sib.sex</span><span class="op">)</span>, alpha<span class="op">=</span><span class="fl">.2</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html" class="external-link">geom_line</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x<span class="op">=</span><span class="va">sib.age</span>, y<span class="op">=</span><span class="fl">1000</span><span class="op">*</span><span class="va">asdr.hat</span>, group<span class="op">=</span><span class="va">sib.sex</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html" class="external-link">theme_minimal</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_continuous.html" class="external-link">scale_y_log10</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">ylab</a></span><span class="op">(</span><span class="st">"1,000 X PRMR"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">ggtitle</a></span><span class="op">(</span><span class="st">'aggregate visibility estimator\npregnancy-related mortality, 7yr before survey'</span><span class="op">)</span></span>
<span><span class="co">#&gt; Warning in scale_y_log10(): <span style="color: #00BB00;">log-10</span> transformation introduced infinite values.</span></span>
<span><span class="co">#&gt; <span style="color: #00BB00;">log-10</span> transformation introduced infinite values.</span></span>
<span><span class="co">#&gt; <span style="color: #00BB00;">log-10</span> transformation introduced infinite values.</span></span></code></pre></div>
<p><img src="maternal-estimates_files/figure-html/unnamed-chunk-21-1.png" class="r-plt" width="700"></p>
<div class="sourceCode" id="cb22"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">compare_boot</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/bind_rows.html" class="external-link">bind_rows</a></span><span class="op">(</span><span class="va">ex_boot_ests</span><span class="op">$</span><span class="va">asdr.ind</span>, <span class="va">ex_boot_ests</span><span class="op">$</span><span class="va">asdr.agg</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="va">compare_boot</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="op">!</span> <span class="va">sib.age</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"[50,55)"</span>, <span class="st">"[55,60)"</span>, <span class="st">"[60,65)"</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_ribbon.html" class="external-link">geom_ribbon</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x<span class="op">=</span><span class="va">sib.age</span>, ymin<span class="op">=</span><span class="fl">1000</span><span class="op">*</span><span class="va">asdr.hat.ci.low</span>, ymax<span class="op">=</span><span class="fl">1000</span><span class="op">*</span><span class="va">asdr.hat.ci.high</span>, fill<span class="op">=</span><span class="va">estimator</span>, group<span class="op">=</span><span class="va">estimator</span><span class="op">)</span>, alpha<span class="op">=</span><span class="fl">.2</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html" class="external-link">geom_line</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x<span class="op">=</span><span class="va">sib.age</span>, y<span class="op">=</span><span class="fl">1000</span><span class="op">*</span><span class="va">asdr.hat</span>, color<span class="op">=</span><span class="va">estimator</span>, group<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/interaction.html" class="external-link">interaction</a></span><span class="op">(</span><span class="va">estimator</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html" class="external-link">theme_minimal</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_continuous.html" class="external-link">scale_y_log10</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">ylab</a></span><span class="op">(</span><span class="st">"1,000 X PRMR"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">ggtitle</a></span><span class="op">(</span><span class="st">'both estimators\npregnancy-related mortality, 7yr before survey'</span><span class="op">)</span></span>
<span><span class="co">#&gt; Warning in scale_y_log10(): <span style="color: #00BB00;">log-10</span> transformation introduced infinite values.</span></span>
<span><span class="co">#&gt; <span style="color: #00BB00;">log-10</span> transformation introduced infinite values.</span></span>
<span><span class="co">#&gt; <span style="color: #00BB00;">log-10</span> transformation introduced infinite values.</span></span></code></pre></div>
<p><img src="maternal-estimates_files/figure-html/unnamed-chunk-22-1.png" class="r-plt" width="700"></p>
<p>Finally, we can calculate the aggregated MMRate for pregnancy-related
mortality using the same bootstrap resamples.</p>
<div class="sourceCode" id="cb23"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">mmrate_boot</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/aggregate_maternal_estimates.html">aggregate_maternal_estimates</a></span><span class="op">(</span><span class="va">ex_boot_ests</span>, <span class="va">ex.ego</span>, <span class="va">ex.sib</span><span class="op">)</span></span>
<span><span class="co">#&gt; Joining with `by = join_by(.ego.id, .weight, sex)`</span></span>
<span><span class="co">#&gt; Joining with `by = join_by(time.period, sib.sex, sib.age, event.name)`</span></span>
<span><span class="co">#&gt; Joining with `by = join_by(time.period, sib.sex, sib.age, boot_idx,</span></span>
<span><span class="co">#&gt; event.name)`</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">mmrate_boot</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] "point"     "boot_summ" "boot"</span></span></code></pre></div>
</div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p>Developed by Dennis M. Feehan.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.2.0.</p>
</div>

    </footer>
</div>





  </body>
</html>
