<!-- Generated by pkgdown: do not edit by hand -->
<!DOCTYPE html>
<html lang="en">
  <head>
  <meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<title>tabulate occurrences and exposures — occ.exp • siblingsurvival</title>


<!-- jquery -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script>
<!-- Bootstrap -->
<link href="https://cdnjs.cloudflare.com/ajax/libs/bootswatch/3.4.0/lumen/bootstrap.min.css" rel="stylesheet" crossorigin="anonymous" />


<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script>

<!-- bootstrap-toc -->
<link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script>

<!-- Font Awesome icons -->
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous" />
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous" />

<!-- clipboard.js -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script>

<!-- headroom.js -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script>

<!-- pkgdown -->
<link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script>




<meta property="og:title" content="tabulate occurrences and exposures — occ.exp" />
<meta property="og:description" content="Given a variable indicating when an event happened,
a time window we are interested in, and possibly a set
of covariates, tabulate counts of event occurences and
exposures in the given time interval.
Note that you have to be careful about observations that
don't experience an event, but still count for exposure;
see the example below." />




<!-- mathjax -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script>

<!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->



  </head>

  <body data-spy="scroll" data-target="#toc">
    <div class="container template-reference-topic">
      <header>
      <div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">siblingsurvival</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">0.1.0</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
        <li>
  <a href="../index.html">
    <span class="fas fa fas fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
    <li>
      <a href="../articles/preparing-data.html">Preparing DHS data</a>
    </li>
    <li>
      <a href="../articles/sibling-estimates.html">Estimating death rates from sibling history data</a>
    </li>
  </ul>
</li>
<li>
  <a href="../news/index.html">Changelog</a>
</li>
      </ul>
      <ul class="nav navbar-nav navbar-right">
        
      </ul>
      
    </div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->

      

      </header>

<div class="row">
  <div class="col-md-9 contents">
    <div class="page-header">
    <h1>tabulate occurrences and exposures</h1>
    
    <div class="hidden name"><code>occ.exp.Rd</code></div>
    </div>

    <div class="ref-description">
    <p>Given a variable indicating when an event happened,
a time window we are interested in, and possibly a set
of covariates, tabulate counts of event occurences and
exposures in the given time interval.<br />
Note that you have to be careful about observations that
don't experience an event, but still count for exposure;
see the example below.</p>
    </div>

    <pre class="usage"><span class='fu'>occ.exp</span><span class='op'>(</span>
  <span class='va'>data</span>,
  <span class='va'>start.obs</span>,
  <span class='va'>end.obs</span>,
  <span class='va'>event</span>,
  <span class='va'>age.groups</span>,
  <span class='va'>time.periods</span>,
  id.var <span class='op'>=</span> <span class='cn'>NULL</span>,
  covars <span class='op'>=</span> <span class='cn'>NULL</span>,
  age.offsets <span class='op'>=</span> <span class='cn'>NULL</span>,
  time.offsets <span class='op'>=</span> <span class='cn'>NULL</span>,
  weights <span class='op'>=</span> <span class='cn'>NULL</span>,
  discretize <span class='op'>=</span> <span class='cn'>FALSE</span>,
  exp.scale <span class='op'>=</span> <span class='fl'>1</span>
<span class='op'>)</span></pre>

    <h2 class="hasAnchor" id="arguments"><a class="anchor" href="#arguments"></a>Arguments</h2>
    <table class="ref-arguments">
    <colgroup><col class="name" /><col class="desc" /></colgroup>
    <tr>
      <th>data</th>
      <td><p>the dataset containing events</p></td>
    </tr>
    <tr>
      <th>start.obs</th>
      <td><p>vector of values (one per row of <code>data</code>) with the starting point
of the observation window for each row, in CMC format</p></td>
    </tr>
    <tr>
      <th>end.obs</th>
      <td><p>vector of values (one per row of <code>data</code>) with the ending point
of the observation window for each row, in CMC format</p></td>
    </tr>
    <tr>
      <th>event</th>
      <td><p>the column of the dataset that indicates the date of an event. observations
that contribute exposure but no events should have this set to a value that
will never occur in the time period; for example, -1</p></td>
    </tr>
    <tr>
      <th>age.groups</th>
      <td><p>an age.groups object</p></td>
    </tr>
    <tr>
      <th>time.periods</th>
      <td><p>a time.periods object</p></td>
    </tr>
    <tr>
      <th>id.var</th>
      <td><p>the variable giving the unique rows of the dataset for each
individual (UNDER DEVELOPMENT)</p></td>
    </tr>
    <tr>
      <th>covars</th>
      <td><p>the name of covariates over which occurrences and exposures should be
aggregated; defaults to NULL, meaning totals are computed over the entire dataset</p></td>
    </tr>
    <tr>
      <th>age.offsets</th>
      <td><p>if not NULL, then the age.periods are to be interpreted relative to
these times (one for each row). this is usually a birth date</p></td>
    </tr>
    <tr>
      <th>time.offsets</th>
      <td><p>if not NULL, then the time.periods are to be interpreted relative to
these times (one for each row). useful for computing quantities like
"X months before interview", where interview happened at different times
for different respondents</p></td>
    </tr>
    <tr>
      <th>weights</th>
      <td><p>the weight to apply to occurrences and exposures; defaults to 1</p></td>
    </tr>
    <tr>
      <th>discretize</th>
      <td><p>if TRUE, turn reported amounts of exposure into a 0/1 exposure or no exposure;
0 exposure when &lt; half of the time interval was spent in the cell and 1 exposure when &gt;= half
of the time interval was spent in the cell; thus, each sib can contribute to exposure in one and only one cell</p></td>
    </tr>
    <tr>
      <th>exp.scale</th>
      <td><p>amount by which to scale exposure; if, for example, dates are measured
in months, but you want to measure rates in years, then this should
be 1/12. It defaults to 1</p></td>
    </tr>
    </table>

    <h2 class="hasAnchor" id="value"><a class="anchor" href="#value"></a>Value</h2>

    <p>a data frame with the covariates, age groups, occurences and expsoures</p>
    <h2 class="hasAnchor" id="details"><a class="anchor" href="#details"></a>Details</h2>

    <p>TODO</p><ul>
<li><p>write unit tests</p></li>
<li><p>fill an example in the documentation below</p></li>
<li><p>at start of code, handle defaults more elegantly</p></li>
<li><p>id.var is not implemented; might be better to directly handle
multiple events (see below)</p></li>
<li><p>handle multiple time periods</p></li>
<li><p>handle multiple events</p></li>
<li><p>handle GK weights (possibly not in this function)</p></li>
<li><p>possibly refactor in the future to pass in dataset of lifelines
and separate list of event dates</p></li>
<li><p>what if event date is missing?</p></li>
<li><p>what about things that vary with the event, eg mother's
age when child was born?</p></li>
<li><p>better description of dates; this was developed using CMC codes
from the DHS surveys, but it should work for any interval scale</p></li>
</ul>


    <h2 class="hasAnchor" id="examples"><a class="anchor" href="#examples"></a>Examples</h2>
    <pre class="examples"><div class='input'>
  <span class='co'>## THESE EXAMPLES ARE NOT UPDATED!</span>
  <span class='co'>## Please disregard for the time being...</span>

  <span class='co'>## RECODE so that observations w/ no births show up</span>
  <span class='co'>## in the dataset at least once by giving them a first</span>
  <span class='co'>## birth at the (impossible) CMC code of -1. This ensures</span>
  <span class='co'>## that they never contribute a birth, but that they</span>
  <span class='co'>## still count for exposure.</span>
  <span class='co'>##</span>
  <span class='co'>## NB: this is a key step. if we don't do this,</span>
  <span class='co'>## women who haven't had any births are removed</span>
  <span class='co'>## from the dataset, biasing rates upward...</span>

  <span class='va'>bdata.coded</span> <span class='op'>&lt;-</span> <span class='va'>bdata</span>
</div><div class='output co'>#&gt; <span class='error'>Error in eval(expr, envir, enclos): object 'bdata' not found</span></div><div class='input'>  <span class='va'>bdata.coded</span><span class='op'>$</span><span class='va'>bdate</span><span class='op'>[</span> <span class='fu'><a href='https://rdrr.io/r/base/NA.html'>is.na</a></span><span class='op'>(</span><span class='va'>bdata.coded</span><span class='op'>$</span><span class='va'>bdate</span><span class='op'>)</span> <span class='op'>&amp;</span>
                    <span class='va'>bdata.coded</span><span class='op'>$</span><span class='va'>bnum</span> <span class='op'>==</span> <span class='st'>"01"</span> <span class='op'>]</span> <span class='op'>&lt;-</span> <span class='op'>-</span><span class='fl'>1</span>
</div><div class='output co'>#&gt; <span class='error'>Error in bdata.coded$bdate[is.na(bdata.coded$bdate) &amp; bdata.coded$bnum ==     "01"] &lt;- -1: object 'bdata.coded' not found</span></div><div class='input'>  <span class='va'>bdata.coded</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/subset.html'>subset</a></span><span class='op'>(</span><span class='va'>bdata.coded</span>, <span class='op'>!</span> <span class='fu'><a href='https://rdrr.io/r/base/NA.html'>is.na</a></span><span class='op'>(</span><span class='va'>bdate</span><span class='op'>)</span> <span class='op'>)</span>
</div><div class='output co'>#&gt; <span class='error'>Error in subset(bdata.coded, !is.na(bdate)): object 'bdata.coded' not found</span></div><div class='input'>
  <span class='co'>## NO COVARIATES:</span>
  <span class='co'>## now use compute.occ.exp to get counts of</span>
  <span class='co'>## births and exposure between 1980 and 1990</span>
  <span class='co'>## for ages 0 to 60</span>

  <span class='co'>## TODO -- need to write this example using new</span>
  <span class='co'>##         version</span>

  <span class='co'>## WITH COVARIATES:</span>
  <span class='co'>##  use compute.occ.exp to get counts of</span>
  <span class='co'>## births and exposure by 5-year period</span>
  <span class='co'>## between 1970 and 2005,</span>
  <span class='co'>## for 5-year age groups [0,5), ..., [60,65)</span>
  <span class='co'>## by the covariates</span>
  <span class='co'>## urban, highestedlevel, and religion</span>
  <span class='co'>## (NOTE: this is just illustrative. we wouldn't recommend</span>
  <span class='co'>##  substantively interpreting the results of this example.)</span>

  <span class='co'>## TODO -- need to write this example using new</span>
  <span class='co'>##         version</span>

</div></pre>
  </div>
  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">
    <nav id="toc" data-toggle="toc" class="sticky-top">
      <h2 data-toc-skip>Contents</h2>
    </nav>
  </div>
</div>


      <footer>
      <div class="copyright">
  <p>Developed by Dennis M. Feehan.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.6.1.</p>
</div>

      </footer>
   </div>

  


  </body>
</html>


