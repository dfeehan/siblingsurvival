<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><title>tabulate occurrences and exposures — occ.exp • siblingsurvival</title><script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet"><script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet"><link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet"><script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="tabulate occurrences and exposures — occ.exp"><meta name="description" content="Given a variable indicating when an event happened,
a time window we are interested in, and possibly a set
of covariates, tabulate counts of event occurences and
exposures in the given time interval.
Note that you have to be careful about observations that
don't experience an event, but still count for exposure;
see the example below."><meta property="og:description" content="Given a variable indicating when an event happened,
a time window we are interested in, and possibly a set
of covariates, tabulate counts of event occurences and
exposures in the given time interval.
Note that you have to be careful about observations that
don't experience an event, but still count for exposure;
see the example below."></head><body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">siblingsurvival</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.3.0</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto"><li class="active nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles"><li><a class="dropdown-item" href="../articles/maternal-estimates.html">Estimating maternal mortality rates from sibling history data</a></li>
    <li><a class="dropdown-item" href="../articles/preparing-data.html">Preparing DHS data</a></li>
    <li><a class="dropdown-item" href="../articles/sibling-estimates.html">Estimating death rates from sibling history data</a></li>
  </ul></li>
<li class="nav-item"><a class="nav-link" href="../news/index.html">Changelog</a></li>
      </ul><ul class="navbar-nav"><li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json"></form></li>
      </ul></div>


  </div>
</nav><div class="container template-reference-topic">
<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">

      <h1>tabulate occurrences and exposures</h1>

      <div class="d-none name"><code>occ.exp.Rd</code></div>
    </div>

    <div class="ref-description section level2">
    <p>Given a variable indicating when an event happened,
a time window we are interested in, and possibly a set
of covariates, tabulate counts of event occurences and
exposures in the given time interval.<br>
Note that you have to be careful about observations that
don't experience an event, but still count for exposure;
see the example below.</p>
    </div>

    <div class="section level2">
    <h2 id="ref-usage">Usage<a class="anchor" aria-label="anchor" href="#ref-usage"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span><span class="fu">occ.exp</span><span class="op">(</span></span>
<span>  <span class="va">data</span>,</span>
<span>  <span class="va">start.obs</span>,</span>
<span>  <span class="va">end.obs</span>,</span>
<span>  <span class="va">event</span>,</span>
<span>  <span class="va">age.groups</span>,</span>
<span>  <span class="va">time.periods</span>,</span>
<span>  id.var <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  covars <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  age.offsets <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  time.offsets <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  weights <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  discretize <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>  exp.scale <span class="op">=</span> <span class="fl">1</span></span>
<span><span class="op">)</span></span></code></pre></div>
    </div>

    <div class="section level2">
    <h2 id="arguments">Arguments<a class="anchor" aria-label="anchor" href="#arguments"></a></h2>


<dl><dt id="arg-data">data<a class="anchor" aria-label="anchor" href="#arg-data"></a></dt>
<dd><p>the dataset containing events</p></dd>


<dt id="arg-start-obs">start.obs<a class="anchor" aria-label="anchor" href="#arg-start-obs"></a></dt>
<dd><p>vector of values (one per row of <code>data</code>) with the starting point
of the observation window for each row, in CMC format</p></dd>


<dt id="arg-end-obs">end.obs<a class="anchor" aria-label="anchor" href="#arg-end-obs"></a></dt>
<dd><p>vector of values (one per row of <code>data</code>) with the ending point
of the observation window for each row, in CMC format</p></dd>


<dt id="arg-event">event<a class="anchor" aria-label="anchor" href="#arg-event"></a></dt>
<dd><p>the column of the dataset that indicates the date of an event. observations
that contribute exposure but no events should have this set to a value that
will never occur in the time period; for example, -1</p></dd>


<dt id="arg-age-groups">age.groups<a class="anchor" aria-label="anchor" href="#arg-age-groups"></a></dt>
<dd><p>an age.groups object</p></dd>


<dt id="arg-time-periods">time.periods<a class="anchor" aria-label="anchor" href="#arg-time-periods"></a></dt>
<dd><p>a time.periods object</p></dd>


<dt id="arg-id-var">id.var<a class="anchor" aria-label="anchor" href="#arg-id-var"></a></dt>
<dd><p>the variable giving the unique rows of the dataset for each
individual (UNDER DEVELOPMENT)</p></dd>


<dt id="arg-covars">covars<a class="anchor" aria-label="anchor" href="#arg-covars"></a></dt>
<dd><p>the name of covariates over which occurrences and exposures should be
aggregated; defaults to NULL, meaning totals are computed over the entire dataset</p></dd>


<dt id="arg-age-offsets">age.offsets<a class="anchor" aria-label="anchor" href="#arg-age-offsets"></a></dt>
<dd><p>if not NULL, then the age.periods are to be interpreted relative to
these times (one for each row). this is usually a birth date</p></dd>


<dt id="arg-time-offsets">time.offsets<a class="anchor" aria-label="anchor" href="#arg-time-offsets"></a></dt>
<dd><p>if not NULL, then the time.periods are to be interpreted relative to
these times (one for each row). useful for computing quantities like
"X months before interview", where interview happened at different times
for different respondents</p></dd>


<dt id="arg-weights">weights<a class="anchor" aria-label="anchor" href="#arg-weights"></a></dt>
<dd><p>the weight to apply to occurrences and exposures; defaults to 1</p></dd>


<dt id="arg-discretize">discretize<a class="anchor" aria-label="anchor" href="#arg-discretize"></a></dt>
<dd><p>if TRUE, turn reported amounts of exposure into a 0/1 exposure or no exposure;
0 exposure when &lt; half of the time interval was spent in the cell and 1 exposure when &gt;= half
of the time interval was spent in the cell; thus, each sib can contribute to exposure in one and only one cell</p></dd>


<dt id="arg-exp-scale">exp.scale<a class="anchor" aria-label="anchor" href="#arg-exp-scale"></a></dt>
<dd><p>amount by which to scale exposure; if, for example, dates are measured
in months, but you want to measure rates in years, then this should
be 1/12. It defaults to 1</p></dd>

</dl></div>
    <div class="section level2">
    <h2 id="value">Value<a class="anchor" aria-label="anchor" href="#value"></a></h2>
    <p>a data frame with the covariates, age groups, occurences and expsoures</p>
    </div>
    <div class="section level2">
    <h2 id="details">Details<a class="anchor" aria-label="anchor" href="#details"></a></h2>
    <p>TODO</p><ul><li><p>write unit tests</p></li>
<li><p>fill an example in the documentation below</p></li>
<li><p>at start of code, handle defaults more elegantly</p></li>
<li><p>id.var is not implemented; might be better to directly handle
multiple events (see below)</p></li>
<li><p>handle multiple time periods</p></li>
<li><p>handle multiple events</p></li>
<li><p>handle GK weights (possibly not in this function)</p></li>
<li><p>possibly refactor in the future to pass in dataset of lifelines
and separate list of event dates</p></li>
<li><p>what if event date is missing?</p></li>
<li><p>what about things that vary with the event, eg mother's
age when child was born?</p></li>
<li><p>better description of dates; this was developed using CMC codes
from the DHS surveys, but it should work for any interval scale</p></li>
</ul></div>

    <div class="section level2">
    <h2 id="ref-examples">Examples<a class="anchor" aria-label="anchor" href="#ref-examples"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span class="r-in"><span></span></span>
<span class="r-in"><span>  <span class="co">## THESE EXAMPLES ARE NOT UPDATED!</span></span></span>
<span class="r-in"><span>  <span class="co">## Please disregard for the time being...</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span>  <span class="co">## RECODE so that observations w/ no births show up</span></span></span>
<span class="r-in"><span>  <span class="co">## in the dataset at least once by giving them a first</span></span></span>
<span class="r-in"><span>  <span class="co">## birth at the (impossible) CMC code of -1. This ensures</span></span></span>
<span class="r-in"><span>  <span class="co">## that they never contribute a birth, but that they</span></span></span>
<span class="r-in"><span>  <span class="co">## still count for exposure.</span></span></span>
<span class="r-in"><span>  <span class="co">##</span></span></span>
<span class="r-in"><span>  <span class="co">## NB: this is a key step. if we don't do this,</span></span></span>
<span class="r-in"><span>  <span class="co">## women who haven't had any births are removed</span></span></span>
<span class="r-in"><span>  <span class="co">## from the dataset, biasing rates upward...</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span>  <span class="va">bdata.coded</span> <span class="op">&lt;-</span> <span class="va">bdata</span></span></span>
<span class="r-err co"><span class="r-pr">#&gt;</span> <span class="error">Error:</span> object 'bdata' not found</span>
<span class="r-in"><span>  <span class="va">bdata.coded</span><span class="op">$</span><span class="va">bdate</span><span class="op">[</span> <span class="fu"><a href="https://rdrr.io/r/base/NA.html" class="external-link">is.na</a></span><span class="op">(</span><span class="va">bdata.coded</span><span class="op">$</span><span class="va">bdate</span><span class="op">)</span> <span class="op">&amp;</span></span></span>
<span class="r-in"><span>                    <span class="va">bdata.coded</span><span class="op">$</span><span class="va">bnum</span> <span class="op">==</span> <span class="st">"01"</span> <span class="op">]</span> <span class="op">&lt;-</span> <span class="op">-</span><span class="fl">1</span></span></span>
<span class="r-err co"><span class="r-pr">#&gt;</span> <span class="error">Error:</span> object 'bdata.coded' not found</span>
<span class="r-in"><span>  <span class="va">bdata.coded</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/subset.html" class="external-link">subset</a></span><span class="op">(</span><span class="va">bdata.coded</span>, <span class="op">!</span> <span class="fu"><a href="https://rdrr.io/r/base/NA.html" class="external-link">is.na</a></span><span class="op">(</span><span class="va">bdate</span><span class="op">)</span> <span class="op">)</span></span></span>
<span class="r-err co"><span class="r-pr">#&gt;</span> <span class="error">Error:</span> object 'bdata.coded' not found</span>
<span class="r-in"><span></span></span>
<span class="r-in"><span>  <span class="co">## NO COVARIATES:</span></span></span>
<span class="r-in"><span>  <span class="co">## now use compute.occ.exp to get counts of</span></span></span>
<span class="r-in"><span>  <span class="co">## births and exposure between 1980 and 1990</span></span></span>
<span class="r-in"><span>  <span class="co">## for ages 0 to 60</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span>  <span class="co">## TODO -- need to write this example using new</span></span></span>
<span class="r-in"><span>  <span class="co">##         version</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span>  <span class="co">## WITH COVARIATES:</span></span></span>
<span class="r-in"><span>  <span class="co">##  use compute.occ.exp to get counts of</span></span></span>
<span class="r-in"><span>  <span class="co">## births and exposure by 5-year period</span></span></span>
<span class="r-in"><span>  <span class="co">## between 1970 and 2005,</span></span></span>
<span class="r-in"><span>  <span class="co">## for 5-year age groups [0,5), ..., [60,65)</span></span></span>
<span class="r-in"><span>  <span class="co">## by the covariates</span></span></span>
<span class="r-in"><span>  <span class="co">## urban, highestedlevel, and religion</span></span></span>
<span class="r-in"><span>  <span class="co">## (NOTE: this is just illustrative. we wouldn't recommend</span></span></span>
<span class="r-in"><span>  <span class="co">##  substantively interpreting the results of this example.)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span>  <span class="co">## TODO -- need to write this example using new</span></span></span>
<span class="r-in"><span>  <span class="co">##         version</span></span></span>
<span class="r-in"><span></span></span>
</code></pre></div>
    </div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside></div>


    <footer><div class="pkgdown-footer-left">
  <p>Developed by Dennis M. Feehan.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.2.0.</p>
</div>

    </footer></div>





  </body></html>

